def paymentSettings():
    import os, json, re

    # Dosya Yolu
    os.makedirs(f'{getScriptsPath()}/scriptData', exist_ok=True)
    script_config_path = f"{getScriptsPath()}/scriptData/payments.json"

    # Ayarlar
    default_settings = {
        "paypal": "",
        "m10": "",
        "usdt": "", 
        "solana": "",
        "ethereum": "",
        "birbank": ""
    }

    # --- Ã‡EVÄ°RÄ° SÄ°STEMÄ° (EN, TR, AZE) ---
    translations = {
        "en": {
            "header": "**ðŸ’³ Payment Instructions ðŸ’³**",
            "step1": "1ï¸âƒ£ Ensure the transaction is completed successfully.",
            "step2": "2ï¸âƒ£ Provide a screenshot of the transaction details as proof of payment.",
            "step3": "3ï¸âƒ£ Make sure the screenshot is **clear** and **uncropped**.",
            "rules_header": "**âš ï¸ Rules for Payment âš ï¸**",
            "rule1": "- Payments must be sent as **Friends & Family (F&F)**.(Only valid for paypal payment method)",
            "rule2": "- Double-check the address before sending funds.",
            "rule3": "- **All payments are non-refundable** in case of errors or incorrect transactions.",
            "rule4": "- Do **NOT** include any notes or memos with the transaction.",
            "network_warning": "-# âš ï¸ USE **TRC20** NETWORK FOR CRYPTO PAYMENTS.", # Yeni UyarÄ±
            "accepted_header": "### Accepted Payment Methods ###",
            "empty": "> No payment methods have been set up."
        },
        "tr": {
            "header": "**ðŸ’³ Ã–deme TalimatlarÄ± ðŸ’³**",
            "step1": "1ï¸âƒ£ Ä°ÅŸlemin baÅŸarÄ±yla tamamlandÄ±ÄŸÄ±ndan emin olun.",
            "step2": "2ï¸âƒ£ Ã–deme kanÄ±tÄ± olarak iÅŸlem detaylarÄ±nÄ±n ekran gÃ¶rÃ¼ntÃ¼sÃ¼nÃ¼ gÃ¶nderin.",
            "step3": "3ï¸âƒ£ Ekran gÃ¶rÃ¼ntÃ¼sÃ¼nÃ¼n **net** ve **kÄ±rpÄ±lmamÄ±ÅŸ** olduÄŸundan emin olun.",
            "rules_header": "**âš ï¸ Ã–deme KurallarÄ± âš ï¸**",
            "rule1": "- Ã–demeler **ArkadaÅŸ ve Aile (F&F)** olarak gÃ¶nderilmelidir.(Sadece PayPal Ä°Ã§in GeÃ§erlidir)",
            "rule2": "- GÃ¶ndermeden Ã¶nce adresi/numarayÄ± iki kez kontrol edin.",
            "rule3": "- HatalÄ± iÅŸlemler durumunda **iade yapÄ±lmamaktadÄ±r**.",
            "rule4": "- Ä°ÅŸleme kesinlikle herhangi bir not veya aÃ§Ä±klama **EKLEMEYÄ°N**.",
            "network_warning": "-# âš ï¸ KRÄ°PTO Ã–DEMELERÄ°NDE **TRC20** AÄžINI KULLANIN.", # Yeni UyarÄ±
            "accepted_header": "### Kabul Edilen Ã–deme YÃ¶ntemleri ###",
            "empty": "> HenÃ¼z Ã¶deme yÃ¶ntemi ayarlanmadÄ±."
        },
        "aze": {
            "header": "**ðŸ’³ Ã–dÉ™niÅŸ TÉ™limatlarÄ± ðŸ’³**",
            "step1": "1ï¸âƒ£ ÆmÉ™liyyatÄ±n uÄŸurla tamamlandÄ±ÄŸÄ±ndan É™min olun.",
            "step2": "2ï¸âƒ£ Ã–dÉ™niÅŸ sÃ¼butu olaraq É™mÉ™liyyat detallarÄ±nÄ±n ekran gÃ¶rÃ¼ntÃ¼sÃ¼nÃ¼ gÃ¶ndÉ™rin.",
            "step3": "3ï¸âƒ£ Ekran gÃ¶rÃ¼ntÃ¼sÃ¼nÃ¼n **aydÄ±n** vÉ™ **kÉ™silmÉ™miÅŸ** olduÄŸundan É™min olun.",
            "rules_header": "**âš ï¸ Ã–dÉ™niÅŸ QaydalarÄ± âš ï¸**",
            "rule1": "- Ã–dÉ™niÅŸlÉ™r **Dostlar vÉ™ AilÉ™ (F&F)** kimi gÃ¶ndÉ™rilmÉ™lidir.(SadecÉ™ Paypal ÃœÃ§Ã¼n KeÃ§É™rlidir)",
            "rule2": "- GÃ¶ndÉ™rmÉ™zdÉ™n É™vvÉ™l Ã¼nvanÄ±/nÃ¶mrÉ™ni iki dÉ™fÉ™ yoxlayÄ±n.",
            "rule3": "- SÉ™hv vÉ™ ya yanlÄ±ÅŸ É™mÉ™liyyatlar zamanÄ± **Ã¶dÉ™niÅŸ qaytarÄ±lmÄ±r**.",
            "rule4": "- ÆmÉ™liyyata heÃ§ bir qeyd vÉ™ ya aÃ§Ä±qlama **ÆLAVÆ ETMÆYÄ°N**.",
            "network_warning": "-# âš ï¸ KRÄ°PTO Ã–DÆNÄ°ÅžLÆRÄ°NDÆ **TRC20** ÅžÆBÆKÆSÄ°NDÆN Ä°STÄ°FADÆ EDÄ°N.", # Yeni UyarÄ±
            "accepted_header": "### QÉ™bul EdilÉ™n Ã–dÉ™niÅŸ ÃœsullarÄ± ###",
            "empty": "> HeÃ§ bir Ã¶dÉ™niÅŸ Ã¼sulu tÉ™yin edilmÉ™yib."
        }
    }

    # JSON YÃ¼kleme ve Onarma
    def loadSettings():
        if os.path.exists(script_config_path):
            try:
                with open(script_config_path, 'r', encoding="utf-8") as f:
                    data = json.load(f)
                for key in default_settings:
                    if key not in data:
                        data[key] = ""
                data = {k: data.get(k, "") for k in default_settings}
                with open(script_config_path, 'w', encoding="utf-8") as f:
                    json.dump(data, f, indent=2)
                return data
            except Exception:
                with open(script_config_path, 'w', encoding="utf-8") as f:
                    json.dump(default_settings, f, indent=2)
                return default_settings
        else:
            with open(script_config_path, 'w', encoding="utf-8") as f:
                json.dump(default_settings, f, indent=2)
            return default_settings

    def updateSetting(key, value):
        settings = loadSettings()
        settings[key] = value
        with open(script_config_path, 'w', encoding="utf-8") as f:
            json.dump(settings, f, indent=2)

    def getSetting(key=None):
        settings = loadSettings()
        return settings.get(key) if key else settings

    # --- Validasyon ---
    def isValidPaypal(email):
        return bool(re.fullmatch(r"[^@]+@[^@]+\.[^@]+", email)) or not email

    def isValidSolana(address):
        return bool(re.fullmatch(r"[1-9A-HJ-NP-Za-km-z]{32,44}", address)) or not address

    def isValidEthereum(address):
        return bool(re.fullmatch(r"0x[a-fA-F0-9]{40}", address)) or not address
    
    def isValidFreeText(text):
        return True

    def validateInput(new_value, current_input, validate_func, key, error_message):
        if not validate_func(new_value):
            current_input.invalid = True
            current_input.error_message = error_message
            return False
        current_input.invalid = False
        current_input.error_message = None
        updateSetting(key, new_value)
        return True

    # Listenerlar
    def checkPaypalInput(new_value):
        return validateInput(new_value, paypal_input, isValidPaypal, "paypal", "GeÃ§ersiz PayPal FormatÄ±.")

    def checkSolanaInput(new_value):
        return validateInput(new_value, solana_input, isValidSolana, "solana", "GeÃ§ersiz Solana Adresi.")

    def checkEthereumInput(new_value):
        return validateInput(new_value, ethereum_input, isValidEthereum, "ethereum", "GeÃ§ersiz Ethereum Adresi.")

    def checkM10Input(new_value):
        return validateInput(new_value, m10_input, isValidFreeText, "m10", "")

    def checkBirbankInput(new_value):
        return validateInput(new_value, birbank_input, isValidFreeText, "birbank", "")
        
    def checkUsdtInput(new_value):
        return validateInput(new_value, usdt_input, isValidFreeText, "usdt", "")

    # --- UI ---
    payment_tab = Tab(name="Payment Settings", title="Payment Settings", icon="calc")
    p_container = payment_tab.create_container(type="columns")
    payment_card = p_container.create_card(height="full", width="full", gap=4)

    payment_card.create_ui_element(UI.Text, content="Payment Methods", size="xl", weight="bold")
    payment_card.create_ui_element(UI.Text, content=f"Usage: {bot.command_prefix}p [en/tr/aze]", size="base", weight="bold", margin="mt-2")

    payment_group = payment_card.create_group(type="columns", gap=3, full_width=True)

    # Inputs
    paypal_input = payment_group.create_ui_element(
        UI.Input, label="PayPal Email", placeholder=getSetting("paypal") or "email@example.com",
        show_clear_button=True, onInput=checkPaypalInput, full_width=True
    )

    m10_input = payment_group.create_ui_element(
        UI.Input, label="M10", placeholder=getSetting("m10") or "M10 NumarasÄ±",
        show_clear_button=True, onInput=checkM10Input, full_width=True
    )

    birbank_input = payment_group.create_ui_element(
        UI.Input, label="Birbank", placeholder=getSetting("birbank") or "Kart NumarasÄ±",
        show_clear_button=True, onInput=checkBirbankInput, full_width=True
    )

    usdt_input = payment_card.create_ui_element(
        UI.Input, label="USDT Address", placeholder=getSetting("usdt") or "USDT (TRC20/ERC20) Adresi",
        show_clear_button=True, onInput=checkUsdtInput, full_width=True
    )

    solana_input = payment_card.create_ui_element(
        UI.Input, label="Solana Address", placeholder=getSetting("solana") or "SOL Adresi",
        show_clear_button=True, onInput=checkSolanaInput, full_width=True
    )

    ethereum_input = payment_card.create_ui_element(
        UI.Input, label="Ethereum Address", placeholder=getSetting("ethereum") or "ETH Adresi",
        show_clear_button=True, onInput=checkEthereumInput, full_width=True
    )

    # --- KOMUT ---
    @bot.command(name="payment", aliases=["payments", "pay", "p"])
    async def payment(ctx, lang="en"):
        await ctx.message.delete()
        
        # Dili belirle (varsayÄ±lan: en)
        lang = lang.lower()
        if lang not in translations:
            lang = "en"
        
        t = translations[lang] # SeÃ§ilen dil paketi
        
        settings = loadSettings()
        payments = {
            "PayPal": settings.get("paypal"),
            "M10": settings.get("m10"),
            "Birbank": settings.get("birbank"),
            "USDT": settings.get("usdt"),
            "Solana": settings.get("solana"),
            "Ethereum": settings.get("ethereum"),
        }
        
        valid_payments = [f"> {name}: **{value}**" for name, value in payments.items() if value]
        
        if valid_payments:
            instructions = (
                f"{t['header']}\n\n"
                f"{t['step1']}\n"
                f"{t['step2']}\n"
                f"{t['step3']}\n\n"
                f"{t['rules_header']}\n"
                f"{t['rule1']}\n"
                f"{t['rule2']}\n"
                f"{t['rule3']}\n"
                f"{t['rule4']}\n\n"
                f"**{t['network_warning']}**\n\n" # TRC20 UyarÄ±sÄ± burada
                f"{t['accepted_header']}\n"
                + "\n".join(valid_payments)
            )
            await ctx.send(instructions)
        else:
            await ctx.send(t['empty'])

    payment_tab.render()

paymentSettings()
